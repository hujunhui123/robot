<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户修改密码设置</title>
    <link href="${s.base}/media/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="${s.base}/media/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>
    <link href="${s.base}/media/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="${s.base}/media/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="${s.base}/media/css/style-responsive.css" rel="stylesheet" type="text/css"/>
    <link href="${s.base}/media/css/light.css" rel="stylesheet" type="text/css"/>

     <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
     <link href="${s.base}/res/css/bootstrapValidator.min.css" rel="stylesheet" type="text/css">-->


    <link rel="icon" type="image/png" href="${s.base}/i/ico.png" sizes="16x16">
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link href="${s.base}/res/css/plane.css" rel="stylesheet" type="text/css"/>
    <link href="${s.base}/media/css/style-metro.css" rel="stylesheet" type="text/css"/>

    <script src="${s.base}/media/js/jquery-1.10.1.min.js" type="text/javascript"></script>
    <script src="${s.base}/js/jquery.form.js" type="text/javascript"></script>
    <script src="${s.base}/media/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="${s.base}/media/js/app.js" type="text/javascript"></script>
    <script src="${s.base}/res/js/plane.js" type="text/javascript"></script>
    <script src="${s.base}/res/js/bootstrapValidator.min.js" type="text/javascript"></script>
    <style>

        .inputfile {
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            position: absolute;
            z-index: -1;
        }

        .inputfile + label {
            font-size: 1.00em;
            font-weight: 600;
            display: inline-block;
            border-radius: 5px;
        }

        .inputfile + label {
            cursor: pointer; /* "hand" cursor */
        }

        .lf15px {
            left: 15px;
        }

        .controls button {
            margin: 20px 15px;
        }

        .help-block {
            color: red;
        }
    </style>
</head>

<body>
<body class="page-header-fixed">
<#include "common/header.html" />
<div class="page-container">
    <#include "common/nav.html" />

    <div class="page-content">
        <!-- BEGIN PAGE CONTAINER-->
        <div class="container-fluid">
            <!--  下面这块内容是在页面写死的  -->
            <!--<h4 class="page-title">我的账号
                <small>个人信息</small>
            </h4>-->

            <h4 class="page-title"></h4>

            <ul class="breadcrumb">
                <li>
                    <i class="icon-home"></i>
                    <a href="#">我的账号</a>
                    <i class="icon-angle-right"></i>
                </li>
                <li>
                    <a href="#">修改信息</a>
                    <i class="icon-angle-right"></i>
                </li>
                <li>
                <li><a href="${s.base}/admin/profileEdit">个人信息</a></li>
                </li>
            </ul>
        </div>

        <div id="dashboard" style="min-height: 86%;">
            <!-- 填充内容 start-->
            <div class="row-fluid" style="margin:auto 30%;">
                <!-- BEGIN EXAMPLE TABLE PORTLET-->
                <form class="form-horizontal" method="post" id="profileForm" role="form" enctype="multipart/form-data">
                    <div style="width:150px;margin:10px 240px;">
                        <div style="width:100%;height:150px;background-color:blue; border-radius:75px;overflow: hidden;">
                            <#if Session["login_user"].icon?exists && Session["login_user"].icon != "">
                            <img src=${Session["login_user"].icon} id="image"
                                 style="height: 100%;width: 100%;" alt="">
                            <#else>
                            <img src="${s.base}/res/i/defaultIcon.jpg" id="image"
                                 style="height: 100%;width: 100%;" alt="">
                            </#if>                           
                        </div>
                        <center style="margin-top:20px;">
                            <input type="file" name="file" id="file" class="inputfile"
                                   accept="image/jpeg,image/jpg,image/png"/>
                            <label for="file" class="btn green">选择图片</label>
                        </center>
                    </div>

                    <div class="control-group form-group has-feedback">
                        <label for="username" class="control-label">账号</label>
                        <div class="controls form-control">
                            <!-- 此处只能存放45(varchar)/2个汉字。 -->
                            <input type="text" id="username" class="m-wrap span4" id="role" name="name"
                                   value="${user.name!}" disabled>
                            <span class="glyphicon glyphicon-user form-control-feedback"></span>
                        </div>
                    </div>

                    <div class="control-group form-group has-feedback">
                        <label for="role" class="control-label">角色</label>
                        <div class="controls form-control">
                            <!-- 此处只能存放45(varchar)/2个汉字。 -->
                                                    <#if Session["super_administrator"]?exists>
                                                        <input type="text" class="m-wrap span4" value="${department!}"
                                                               id="role" disabled>
                                                    <#else >
                                                        <input type="text" class="m-wrap span4" value="${department!}"
                                                               id="role" disabled>
                                                    </#if>
                            <span class="glyphicon glyphicon-user form-control-feedback"></span>
                        </div>
                    </div>

                    <div class="control-group form-group has-feedback">
                        <label for="worknumber" class="col-sm-2 control-label">工号</label>
                        <div class="controls">
                            <!-- 此处只能存放45(varchar)/2个汉字。 -->
                            <input type="text" class="m-wrap span4" name="worknumber"
                                   id="worknumber" value="${user.worknumber!}" maxlength="20" disabled>
                            <span class="glyphicon glyphicon-user form-control-feedback"></span>
                        </div>
                    </div>

            <div class="control-group form-group has-feedback">
                <label class="control-label" style="white-space:nowrap">部门</label>
                <div class="controls">
                    <select class="medium m-wrap" tabindex="1" style="width: 300px !important;">
                        <option value="1">广西壮族自治区</option>
                    </select>
                    <select class="small m-wrap" tabindex="1" name="userProfileDepartment" id="userProfileDepartment" style="width: 207px !important;">
                        <option value="2">南宁市</option>
                        <option value="3">桂林市</option>
                        <option value="4">崇左市</option>
                        <option value="5">柳州市</option>
                        <option value="6">来宾市</option>
                        <option value="7">梧州市</option>
                        <option value="8">贺州市</option>
                        <option value="9">玉林市</option>
                        <option value="10">贵港市</option>
                        <option value="11">百色市</option>
                        <option value="12">钦州市</option>
                        <option value="13">河池市</option>
                        <option value="14">北海市</option>
                        <option value="15">防城港市</option>
                    </select>
                </div>
            </div>
                    <div class="control-group form-group has-feedback">
                        <label for="nickname" class="control-label">昵称</label>
                        <div class="controls form-control">
                            <!-- 此处只能存放45(varchar)/2个汉字。 -->
                            <input type="text" class="m-wrap span4" name="nickname"
                                   id="nickname" value="${user.nickname!}" maxlength="20">
                            <span class="glyphicon glyphicon-user form-control-feedback"></span>
                        </div>
                    </div>

                    <div class="control-group form-group has-feedback">
                        <label for="email" class="col-sm-2 control-label">邮箱</label>
                        <div class="controls ">
                            <input type="email" class="m-wrap span4" id="email" name="email"
                                   value="${user.email!}">
                            <span class="glyphicon glyphicon-user form-control-feedback"></span>
                        </div>
                    </div>

                    <div class="control-group form-group has-feedback">
                        <label for="phone1" class="col-sm-2 control-label">电话1</label>
                        <div class="controls">
                            <input type="text" class="m-wrap span4" id="phonenumber1"
                                   name="phoneone" value="${user.phoneone!}">
                            <span class="glyphicon glyphicon-phone form-control-feedback"></span>
                        </div>
                    </div>

                    <div class="control-group form-group has-feedback">
                        <label for="phone2" class="col-sm-2 control-label">电话2</label>
                        <div class="controls">
                            <input type="text" class="m-wrap span4" id="phonenumber2"
                                   name="phonetwo" value="${user.phonetwo!}">
                            <span class="glyphicon glyphicon-phone-alt form-control-feedback"></span>
                        </div>
                    </div>

                    <div class="control-group form-group has-feedback">
                        <label for="description" class="col-sm-2 control-label">个人简介</label>
                        <div class="controls">
                            <!-- 此处只能存放45(varchar)/2个汉字。 -->
                            <input type="textarea" class="m-wrap span4" rows="4"
                                   maxlength="20" id="description" name="description"
                                   value="${user.description!}"/>
                            <span class="glyphicon glyphicon-pencil form-control-feedback"></span>
                        </div>
                    </div>

                    <div class="control-group form-group has-feedback">
                        <div class="controls">
                            <button type="reset" class="btn" id="restart">重置</button>
                            <button type="button" class="btn green" id="modify">修改</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="_ocDialogModal" tabindex="-1" aria-hidden="true">
    <div class="modal_wapper small">
        <div class="modal-dialog w-4">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>
                    <div class="modal-title f-16">提示信息</div>
                </div>
                <div class="modal-body">
                    <div><span class="color-oc f-16" id="resText" style="font-size:1.2rem;">修改个人信息成功！</span></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    jQuery(document).ready(function () {
        App.init();
    });

    $(function(){
        $("#userProfileDepartment").find("option[value = '"+${user.departmentId!}+"']").attr("selected","selected");
    })

    //初始化验证规则函数
    $("#modify").on("click", function () {
        //获取表单对象

        var bootstrapValidator = $('#profileForm').data('bootstrapValidator');
        //手动触发验证
        bootstrapValidator.validate();
        if (bootstrapValidator.isValid()) {
            // 验证成功可以直接提交ajax请求
            var option = {
                type: 'POST',
                url: '${s.base}/admin/doprofileEdit.action',
                dataType: 'json',
                data: $("#profileForm").serialize(),
                success: function (result) {
                    $("#resText").text(result.message);
                    Modal.show('_ocDialogModal');
                    setTimeout("window.location.reload()", 2000);

                }, error: function () {
                    $("#resText").text("出错了，请重试!");
                    Modal.show('_ocDialogModal');
                }
            };
            $("#profileForm").ajaxSubmit(option);
        }

    });
    var validatorInit = function () {
        $("#profileForm").bootstrapValidator({
            live: 'enabled',//验证时机，enabled是内容有变化就验证（默认），disabled和submitted是提交再验证
            excluded: [':disabled', ':hidden', ':not(:visible)'],//排除无需验证的控件，比如被禁用的或者被隐藏的
            submitButtons: '#modify',
            //指定提交按钮，如果验证失败则变成disabled
            message: '操作失败',//通用的验证失败消息
            feedbackIcons: {//根据验证结果显示的各种图标
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                nickname: {
                    validators: {
                        //notEmpty: {//检测非空,radio也可用
                        //  message: '昵称必须输入'
                        //},
                        stringLength: {//检测长度
                            max: 10,
                            message: '长度过长'
                        }
                    }
                },
                phoneone: {
                    validators: {
                        stringLength: {
                            min: 11,
                            max: 11,
                            message: '请输入11位手机号码'
                        },
                        regexp: {
                            regexp: /^[0-9]/,
                            message: '仅能输入数字'
                        }
                    }
                },
                worknumber: {
                    validators: {
                        notEmpty: {//检测非空,radio也可用
                            message: '工号必须输入'
                        },
                        stringLength: {//检测长度
                            min: 6,
                            max: 15,
                            message: '长度6-15位'
                        }
                    }
                },
                phonetwo: {
                    validators: {
                        stringLength: {
                            min: 11,
                            max: 11,
                            message: '请输入11位号码'
                        },
                        regexp: {
                            regexp: /^[0-9]/,
                            message: '仅能输入数字'
                        }
                    }
                },
                description: {
                    validators: {
                        stringLength: {
                            max: 45,
                            message: '描述长度限制'
                        }
                    }
                },
            }
        });
    }


    $(function () {
        var onValidatorInit = new validatorInit();
        // $("#modify").click(function () {//非submit按钮点击后进行验证，如果是submit则无需此句直接验证
        //     $("#form-test").bootstrapValidator('validate');//提交验证
        //     if ($("#form-test").data('bootstrapValidator').isValid()) {//获取验证结果，如果成功，执行下面代码
        //         alert("yes");//验证成功后的操作，如ajax
        //     }
        // });
    });

    $("#file").change(function () {     //头像部分
        // getObjectURL是自定义的函数，见下面
        // this.files[0]代表的是选择的文件资源的第一个，因为上面写了 multiple="multiple" 就表示上传文件可能不止一个
        // ，但是这里只读取第一个
        var objUrl = getObjectURL(this.files[0]);
        // console.log("objUrl = "+objUrl) ;
        if (objUrl) {
            // 在这里修改图片的地址属性
            $("#image").attr("src", objUrl);
        }
    });

    //建立一個可存取到該file的url  
    function getObjectURL(file) {
        var url = null;
        // 下面函数执行的效果是一样的，只是需要针对不同的浏览器执行不同的 js 函数而已
        if (window.createObjectURL != undefined) { // basic
            url = window.createObjectURL(file);
        } else if (window.URL != undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file);
        } else if (window.webkitURL != undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file);
        }
        return url;
    }

    $("#restart").click(function () {            //重置表单
        $("#profileForm").data('bootstrapValidator').destroy();
        $("#profileForm").data('bootstrapValidator', null);
        var onValidatorInit = new validatorInit();
    });

</script>
</body>
</html>

